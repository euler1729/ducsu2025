<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUCSU 2025 Election Probability Model - Complete Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeIn 1s ease-in;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .countdown-timer {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 20px auto;
            max-width: 500px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .understanding-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border: 2px solid #f59e0b;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .understanding-box h3 {
            color: #92400e;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .understanding-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .understanding-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        .understanding-item strong {
            color: #92400e;
            display: block;
            margin-bottom: 5px;
        }

        .understanding-item span {
            color: #666;
            font-size: 0.9rem;
        }

        .model-controls {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.8s ease-out;
        }

        .scenario-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .scenario-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .scenario-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .scenario-btn.active {
            background: #667eea;
            color: white;
        }

        .factors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .factor-control {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .factor-control label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .factor-control input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }

        .factor-value {
            text-align: center;
            color: #667eea;
            font-weight: bold;
        }

        .probability-meaning {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .probability-meaning h3 {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .meaning-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .meaning-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .meaning-range {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .meaning-description {
            font-size: 0.9rem;
            color: #666;
        }

        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            animation: fadeInUp 0.8s ease-out;
            position: relative;
        }

        .panel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .rank-badge {
            position: absolute;
            top: -10px;
            right: 20px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .panel-header {
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .panel-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .panel-subtitle {
            color: #666;
            font-size: 0.9rem;
        }

        .probability-display {
            text-align: center;
            margin: 20px 0;
        }

        .probability-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            position: relative;
        }

        .probability-svg {
            transform: rotate(-90deg);
        }

        .probability-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: bold;
        }

        .probability-label {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: #666;
            text-align: center;
            width: 100%;
        }

        .position-probabilities {
            margin-top: 15px;
        }

        .position-row {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 5px;
            align-items: center;
        }

        .position-name {
            font-weight: 600;
            color: #555;
            font-size: 0.85rem;
            flex: 1;
        }

        .position-prob {
            font-weight: bold;
            color: #667eea;
            margin-left: 10px;
        }

        .strength-indicators {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .strength-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            margin-bottom: 10px;
        }

        .strength-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .strength-label {
            font-size: 0.8rem;
            color: #666;
            width: 100px;
        }

        .strength-bar {
            flex: 1;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin: 0 10px;
            position: relative;
        }

        .strength-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .strength-value {
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            width: 35px;
            text-align: right;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 300px;
            padding: 20px;
            border-left: 2px solid #ddd;
            border-bottom: 2px solid #ddd;
        }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            max-width: 100px;
        }

        .bar {
            width: 60px;
            background: linear-gradient(to top, #667eea, #a78bfa);
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
            position: relative;
        }

        .bar-label {
            margin-top: 10px;
            font-size: 0.8rem;
            text-align: center;
            color: #666;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-weight: bold;
            color: #333;
        }

        .comparison-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .comparison-table h3 {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .scenario-impact {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .scenario-impact h3 {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .impact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .impact-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .impact-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .impact-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .impact-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .impact-effect {
            font-size: 0.85rem;
            color: #667eea;
            font-weight: 600;
        }

        .insights-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .insights-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .insight-item {
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 5px;
        }

        .key-factors {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .key-factors h3 {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .factor-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 1px solid #bae6fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .factor-card h4 {
            color: #0c4a6e;
            margin-bottom: 10px;
        }

        .factor-card p {
            color: #64748b;
            font-size: 0.9rem;
        }

        .footer {
            text-align: center;
            color: white;
            padding: 30px 0;
            opacity: 0.9;
        }

        .footer p {
            margin-bottom: 10px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid white;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🗳️ DUCSU 2025 Election Probability Model</h1>
            <p>Complete Interactive Analysis & Predictions</p>
            <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">39,775 registered voters | 28 positions | 565+ candidates</p>
            <div class="countdown-timer" id="countdown">
                Election Day: September 9, 2025 (8:00 AM - 3:00 PM)
            </div>
        </div>

        <div class="understanding-box">
            <h3>⚠️ Critical: Understanding What These Numbers Mean</h3>
            <div class="understanding-grid">
                <div class="understanding-item">
                    <strong>Winning Probability ≠ Vote Share</strong>
                    <span>35% probability means winning 35 out of 100 elections, NOT getting 35% of votes</span>
                </div>
                <div class="understanding-item">
                    <strong>Internal Strength ≠ Winning Chance</strong>
                    <span>95% cohesion is party unity, NOT 95% chance to win. Strong teams can still lose!</span>
                </div>
                <div class="understanding-item">
                    <strong>Why No One Has 90%+ Probability</strong>
                    <span>With 5 strong panels and 48.5% undecided voters, even favorites stay below 50%</span>
                </div>
                <div class="understanding-item">
                    <strong>Position Differences Matter</strong>
                    <span>VP needs charisma (media/social), GS needs organization, causing different odds</span>
                </div>
            </div>
        </div>

        <div class="model-controls">
            <h3 style="margin-bottom: 15px; color: #333;">Select Scenario to See How Conditions Change Probabilities</h3>
            <div class="scenario-selector">
                <button class="scenario-btn active" onclick="setScenario('base')">Base Case</button>
                <button class="scenario-btn" onclick="setScenario('highTurnout')">High Turnout (60%+)</button>
                <button class="scenario-btn" onclick="setScenario('lowTurnout')">Low Turnout (<30%)</button>
                <button class="scenario-btn" onclick="setScenario('femaleVote')">Female Vote Surge</button>
                <button class="scenario-btn" onclick="setScenario('hallDominance')">Hall Politics Strong</button>
                <button class="scenario-btn" onclick="setScenario('movementWave')">Movement Wave</button>
                <button class="scenario-btn" onclick="setScenario('custom')">Custom Factors</button>
            </div>

            <div class="factors-grid" id="factorsGrid" style="display: none;">
                <div class="factor-control">
                    <label>Organizational Strength Weight</label>
                    <input type="range" id="orgFactor" min="0" max="100" value="30" oninput="updateFactor('org', this.value)">
                    <div class="factor-value" id="orgValue">30%</div>
                </div>
                <div class="factor-control">
                    <label>Media Visibility Weight</label>
                    <input type="range" id="mediaFactor" min="0" max="100" value="20" oninput="updateFactor('media', this.value)">
                    <div class="factor-value" id="mediaValue">20%</div>
                </div>
                <div class="factor-control">
                    <label>Social Movement Weight</label>
                    <input type="range" id="socialFactor" min="0" max="100" value="25" oninput="updateFactor('social', this.value)">
                    <div class="factor-value" id="socialValue">25%</div>
                </div>
                <div class="factor-control">
                    <label>Hall Politics Weight</label>
                    <input type="range" id="hallFactor" min="0" max="100" value="25" oninput="updateFactor('hall', this.value)">
                    <div class="factor-value" id="hallValue">25%</div>
                </div>
            </div>
        </div>

        <div class="probability-meaning">
            <h3>📊 Probability Range Meanings - What Each Range Actually Means</h3>
            <div class="meaning-grid">
                <div class="meaning-item">
                    <div class="meaning-range">0-20%</div>
                    <div class="meaning-description">Underdog - Needs perfect campaign + major surprises</div>
                </div>
                <div class="meaning-item">
                    <div class="meaning-range">20-30%</div>
                    <div class="meaning-description">Competitive - Realistic chance with strong execution</div>
                </div>
                <div class="meaning-item" style="border-color: #f59e0b; background: #fef3c7;">
                    <div class="meaning-range" style="color: #f59e0b;">30-40%</div>
                    <div class="meaning-description"><strong>Frontrunner</strong> - Leading but far from guaranteed</div>
                </div>
                <div class="meaning-item">
                    <div class="meaning-range">40-50%</div>
                    <div class="meaning-description">Strong Favorite - Clear advantage, still contestable</div>
                </div>
                <div class="meaning-item">
                    <div class="meaning-range">50%+</div>
                    <div class="meaning-description">Likely Winner - More likely to win than lose</div>
                </div>
            </div>
        </div>

        <div class="results-container" id="resultsContainer">
            <!-- Panel cards will be inserted here dynamically -->
        </div>

        <div class="chart-container">
            <div class="chart-title">Overall Winning Probability by Panel (NOT Vote Share!)</div>
            <div class="bar-chart" id="barChart">
                <!-- Bar chart will be inserted here dynamically -->
            </div>
        </div>

        <div class="comparison-table">
            <h3>📋 Head-to-Head Comparison Matrix</h3>
            <table id="comparisonTable">
                <!-- Table will be populated dynamically -->
            </table>
        </div>

        <div class="scenario-impact">
            <h3>🎯 Scenario Impact Analysis</h3>
            <div class="impact-grid">
                <div class="impact-card">
                    <div class="impact-title">📈 High Turnout Impact</div>
                    <div class="impact-description">When turnout exceeds 60%, social movement credibility becomes crucial</div>
                    <div class="impact-effect">Favors: Umama Fatema (+7%), Hurts: Shibir (-6%)</div>
                </div>
                <div class="impact-card">
                    <div class="impact-title">📉 Low Turnout Impact</div>
                    <div class="impact-description">Below 30% turnout amplifies organizational machinery importance</div>
                    <div class="impact-effect">Favors: Shibir (+10%), Hurts: Independents (-8%)</div>
                </div>
                <div class="impact-card">
                    <div class="impact-title">👥 Female Vote Surge</div>
                    <div class="impact-description">18,902 female voters mobilized could reshape dynamics</div>
                    <div class="impact-effect">Favors: Umama (+5%), Left (+3%), Neutral: Others</div>
                </div>
                <div class="impact-card">
                    <div class="impact-title">🏢 Hall Politics Dominance</div>
                    <div class="impact-description">Residential hall influence determines outcome</div>
                    <div class="impact-effect">Favors: Shibir (+12%), Hurts: Independents (-10%)</div>
                </div>
                <div class="impact-card">
                    <div class="impact-title">✊ Movement Wave</div>
                    <div class="impact-description">July 2024 uprising momentum continues strong</div>
                    <div class="impact-effect">Favors: Umama (+10%), Left (+5%), Hurts: Traditional parties</div>
                </div>
                <div class="impact-card">
                    <div class="impact-title">🔄 Undecided Break</div>
                    <div class="impact-description">48.5% undecided voters (19,300) decide last minute</div>
                    <div class="impact-effect">Could swing ANY panel to 50%+ if they break 60-40</div>
                </div>
            </div>
        </div>

        <div class="key-factors">
            <h3>🔑 Key Factors That Will Decide the Election</h3>
            <div class="factor-card">
                <h4>1. Undecided Voter Mobilization (48.5% of electorate)</h4>
                <p>Nearly half of registered voters remain undecided. Whichever panel can mobilize even 60% of these voters will likely win regardless of current projections. Last-minute campaigning and get-out-the-vote efforts will be crucial.</p>
            </div>
            <div class="factor-card">
                <h4>2. Female Voter Turnout (18,902 registered)</h4>
                <p>Female students represent 47.5% of the electorate. Relocating women's polling stations could affect turnout. Panels that effectively address women's concerns and ensure safe voting access gain significant advantage.</p>
            </div>
            <div class="factor-card">
                <h4>3. Hall Politics vs. Movement Credibility</h4>
                <p>Traditional hall-based politics (Shibir's strength) competes with post-uprising movement credibility (Umama's advantage). The balance between these forces will shape the outcome.</p>
            </div>
            <div class="factor-card">
                <h4>4. Organizational Capacity on Election Day</h4>
                <p>With only 7 hours of voting (8 AM - 3 PM), mobilization efficiency matters. Panels with stronger ground organization can ensure their supporters actually vote.</p>
            </div>
            <div class="factor-card">
                <h4>5. Strategic Voting and Ticket-Splitting</h4>
                <p>Voters may split tickets - choosing different panels for VP, GS, and AGS positions. This could lead to mixed results rather than clean sweeps.</p>
            </div>
        </div>

        <div class="insights-section">
            <div class="insights-title">📊 Dynamic Analysis & Key Insights</div>
            <div id="insightsContainer">
                <!-- Insights will be inserted here dynamically -->
            </div>
        </div>

        <div class="footer">
            <p><strong>Model Last Updated:</strong> August 21, 2025 | Based on current political dynamics</p>
            <p><strong>Disclaimer:</strong> This is a probability model, not a prediction. Actual results depend on campaign execution, turnout, and last-minute developments.</p>
            <p style="font-size: 0.9rem; opacity: 0.8;">Remember: 38% probability means winning 38 out of 100 simulated elections, not 38% of the vote!</p>
        </div>
    </div>

    <script>
        // Panel data with candidates and base strengths
        const panels = [
            {
                id: 'shibir',
                name: 'United Students\' Alliance',
                party: 'Islami Chhatra Shibir',
                color: '#4ade80',
                candidates: {
                    vp: 'Shadiq Kayem',
                    gs: 'SM Farhad',
                    ags: 'Mohiuddin Khan'
                },
                strengths: {
                    org: 90,
                    media: 65,
                    social: 55,
                    hall: 85,
                    cohesion: 95
                }
            },
            {
                id: 'independent',
                name: 'Independent Students\' Unity',
                party: 'Led by Umama Fatema',
                color: '#60a5fa',
                candidates: {
                    vp: 'Umama Fatema Al Sadi',
                    gs: 'Bhuiyan Mohiuddin',
                    ags: 'Mujahid Mahi'
                },
                strengths: {
                    org: 70,
                    media: 85,
                    social: 95,
                    hall: 45,
                    cohesion: 80
                }
            },
            {
                id: 'jcd',
                name: 'Jatiyatabadi Chhatra Dal',
                party: 'JCD',
                color: '#f59e0b',
                candidates: {
                    vp: 'Md Abidul Islam Khan',
                    gs: 'Sheikh Tanvir Bari Hamim',
                    ags: 'Tanvir Al Hadi Mayed'
                },
                strengths: {
                    org: 60,
                    media: 70,
                    social: 65,
                    hall: 55,
                    cohesion: 55
                }
            },
            {
                id: 'left',
                name: 'Aparajeyo 71–Odomyo 24',
                party: 'Left Coalition',
                color: '#ef4444',
                candidates: {
                    vp: 'Sheikh Tasnim Afroz Emi',
                    gs: 'Meghmallar Bosu',
                    ags: 'Md Jabir Ahmed Jubel'
                },
                strengths: {
                    org: 65,
                    media: 75,
                    social: 70,
                    hall: 40,
                    cohesion: 70
                }
            },
            {
                id: 'others',
                name: 'Other Panels',
                party: 'Various',
                color: '#9ca3af',
                candidates: {
                    vp: 'Various Candidates',
                    gs: 'Various Candidates',
                    ags: 'Various Candidates'
                },
                strengths: {
                    org: 40,
                    media: 45,
                    social: 40,
                    hall: 35,
                    cohesion: 45
                }
            }
        ];

        // Current scenario and factors
        let currentScenario = 'base';
        let factors = {
            org: 0.3,
            media: 0.2,
            social: 0.25,
            hall: 0.25
        };

        // Scenario presets
        const scenarios = {
            base: {
                org: 0.3,
                media: 0.2,
                social: 0.25,
                hall: 0.25
            },
            highTurnout: {
                org: 0.25,
                media: 0.25,
                social: 0.35,
                hall: 0.15
            },
            lowTurnout: {
                org: 0.35,
                media: 0.15,
                social: 0.20,
                hall: 0.30
            },
            femaleVote: {
                org: 0.25,
                media: 0.25,
                social: 0.35,
                hall: 0.15
            },
            hallDominance: {
                org: 0.25,
                media: 0.15,
                social: 0.20,
                hall: 0.40
            },
            movementWave: {
                org: 0.20,
                media: 0.25,
                social: 0.40,
                hall: 0.15
            },
            custom: {
                org: 0.25,
                media: 0.25,
                social: 0.25,
                hall: 0.25
            }
        };

        function setScenario(scenario) {
            currentScenario = scenario;
            factors = {...scenarios[scenario]};
            
            // Show loading overlay
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            setTimeout(() => {
                // Update button states
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.classList.remove('active');
                    if (btn.textContent.toLowerCase().includes(scenario.toLowerCase()) || 
                        (scenario === 'base' && btn.textContent === 'Base Case') ||
                        (scenario === 'highTurnout' && btn.textContent.includes('High Turnout')) ||
                        (scenario === 'lowTurnout' && btn.textContent.includes('Low Turnout')) ||
                        (scenario === 'femaleVote' && btn.textContent.includes('Female Vote')) ||
                        (scenario === 'hallDominance' && btn.textContent.includes('Hall Politics')) ||
                        (scenario === 'movementWave' && btn.textContent.includes('Movement Wave')) ||
                        (scenario === 'custom' && btn.textContent === 'Custom Factors')) {
                        btn.classList.add('active');
                    }
                });
                
                // Show/hide custom controls
                document.getElementById('factorsGrid').style.display = 
                    scenario === 'custom' ? 'grid' : 'none';
                
                // Update sliders if custom
                if (scenario === 'custom') {
                    document.getElementById('orgFactor').value = factors.org * 100;
                    document.getElementById('mediaFactor').value = factors.media * 100;
                    document.getElementById('socialFactor').value = factors.social * 100;
                    document.getElementById('hallFactor').value = factors.hall * 100;
                    document.getElementById('orgValue').textContent = Math.round(factors.org * 100) + '%';
                    document.getElementById('mediaValue').textContent = Math.round(factors.media * 100) + '%';
                    document.getElementById('socialValue').textContent = Math.round(factors.social * 100) + '%';
                    document.getElementById('hallValue').textContent = Math.round(factors.hall * 100) + '%';
                }
                
                updateModel();
                
                // Hide loading overlay
                document.getElementById('loadingOverlay').style.display = 'none';
            }, 300);
        }

        function updateFactor(factor, value) {
            const percentage = value / 100;
            document.getElementById(factor + 'Value').textContent = value + '%';
            
            // Simple normalization - adjust all factors proportionally
            factors[factor] = percentage;
            const sum = Object.values(factors).reduce((a, b) => a + b, 0);
            if (sum > 0) {
                Object.keys(factors).forEach(key => {
                    factors[key] = factors[key] / sum;
                });
            }
            
            // Update all slider displays
            Object.keys(factors).forEach(key => {
                document.getElementById(key + 'Value').textContent = Math.round(factors[key] * 100) + '%';
                if (key !== factor) {
                    document.getElementById(key + 'Factor').value = factors[key] * 100;
                }
            });
            
            updateModel();
        }

        function calculateProbabilities(panel) {
            // Calculate weighted score (this is internal strength, not probability)
            const baseScore = 
                panel.strengths.org * factors.org +
                panel.strengths.media * factors.media +
                panel.strengths.social * factors.social +
                panel.strengths.hall * factors.hall;
            
            // Apply cohesion penalty/bonus
            const cohesionMultiplier = 0.8 + (panel.strengths.cohesion / 100) * 0.4;
            const adjustedScore = baseScore * cohesionMultiplier;
            
            // Position-specific adjustments
            const vpProb = adjustedScore * (1 + (panel.strengths.media * 0.002) + (panel.strengths.social * 0.002));
            const gsProb = adjustedScore * (1 + (panel.strengths.org * 0.003));
            const agsProb = adjustedScore * (1 + (panel.strengths.org * 0.001) + (panel.strengths.hall * 0.001));
            
            return {
                overall: Math.min(95, Math.max(5, adjustedScore)),
                vp: Math.min(95, Math.max(5, vpProb)),
                gs: Math.min(95, Math.max(5, gsProb)),
                ags: Math.min(95, Math.max(5, agsProb))
            };
        }

        function normalizeOverallProbabilities(panelProbs) {
            const total = panelProbs.reduce((sum, p) => sum + p.probs.overall, 0);
            return panelProbs.map(p => ({
                ...p,
                probs: {
                    ...p.probs,
                    overall: (p.probs.overall / total) * 100
                }
            }));
        }

        function updateModel() {
            // Calculate probabilities for each panel
            let panelResults = panels.map(panel => ({
                ...panel,
                probs: calculateProbabilities(panel)
            }));
            
            // Normalize overall probabilities
            panelResults = normalizeOverallProbabilities(panelResults);
            
            // Sort by probability for ranking
            panelResults.sort((a, b) => b.probs.overall - a.probs.overall);
            
            // Update all components
            updatePanelCards(panelResults);
            updateBarChart(panelResults);
            updateComparisonTable(panelResults);
            updateInsights(panelResults);
        }

        function updatePanelCards(panelResults) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = panelResults.map((panel, index) => `
                <div class="panel-card">
                    ${index === 0 ? '<div class="rank-badge">#1 Frontrunner</div>' : 
                      index === 1 ? '<div class="rank-badge" style="background: linear-gradient(135deg, #cbd5e1, #94a3b8);">#2 Challenger</div>' : 
                      index === 2 ? '<div class="rank-badge" style="background: linear-gradient(135deg, #f3f4f6, #d1d5db);">#3 Contender</div>' : ''}
                    <div class="panel-header">
                        <div class="panel-name">${panel.name}</div>
                        <div class="panel-subtitle">${panel.party}</div>
                    </div>
                    <div class="probability-display">
                        <div class="probability-circle">
                            <svg class="probability-svg" width="120" height="120">
                                <circle cx="60" cy="60" r="50" fill="none" stroke="#e0e0e0" stroke-width="10"/>
                                <circle cx="60" cy="60" r="50" fill="none" stroke="${panel.color}" 
                                    stroke-width="10" stroke-linecap="round"
                                    stroke-dasharray="${panel.probs.overall * 3.14} 314"/>
                            </svg>
                            <div class="probability-text" style="color: ${panel.color}">
                                ${panel.probs.overall.toFixed(1)}%
                            </div>
                            <div class="probability-label">Winning<br>Probability</div>
                        </div>
                    </div>
                    <div class="position-probabilities">
                        <div class="position-row">
                            <span class="position-name">VP: ${panel.candidates.vp}</span>
                            <span class="position-prob">${panel.probs.vp.toFixed(1)}%</span>
                        </div>
                        <div class="position-row">
                            <span class="position-name">GS: ${panel.candidates.gs}</span>
                            <span class="position-prob">${panel.probs.gs.toFixed(1)}%</span>
                        </div>
                        <div class="position-row">
                            <span class="position-name">AGS: ${panel.candidates.ags}</span>
                            <span class="position-prob">${panel.probs.ags.toFixed(1)}%</span>
                        </div>
                    </div>
                    <div class="strength-indicators">
                        <div class="strength-title">Internal Strengths (NOT winning chances)</div>
                        <div class="strength-row">
                            <span class="strength-label">Organization</span>
                            <div class="strength-bar">
                                <div class="strength-fill" style="width: ${panel.strengths.org}%; background: #4ade80;"></div>
                            </div>
                            <span class="strength-value">${panel.strengths.org}%</span>
                        </div>
                        <div class="strength-row">
                            <span class="strength-label">Media</span>
                            <div class="strength-bar">
                                <div class="strength-fill" style="width: ${panel.strengths.media}%; background: #60a5fa;"></div>
                            </div>
                            <span class="strength-value">${panel.strengths.media}%</span>
                        </div>
                        <div class="strength-row">
                            <span class="strength-label">Social Move</span>
                            <div class="strength-bar">
                                <div class="strength-fill" style="width: ${panel.strengths.social}%; background: #f59e0b;"></div>
                            </div>
                            <span class="strength-value">${panel.strengths.social}%</span>
                        </div>
                        <div class="strength-row">
                            <span class="strength-label">Hall Politics</span>
                            <div class="strength-bar">
                                <div class="strength-fill" style="width: ${panel.strengths.hall}%; background: #ef4444;"></div>
                            </div>
                            <span class="strength-value">${panel.strengths.hall}%</span>
                        </div>
                        <div class="strength-row">
                            <span class="strength-label">Cohesion</span>
                            <div class="strength-bar">
                                <div class="strength-fill" style="width: ${panel.strengths.cohesion}%; background: #a78bfa;"></div>
                            </div>
                            <span class="strength-value">${panel.strengths.cohesion}%</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateBarChart(panelResults) {
            const container = document.getElementById('barChart');
            const maxProb = Math.max(...panelResults.map(p => p.probs.overall));
            
            container.innerHTML = panelResults.map(panel => `
                <div class="bar-group">
                    <div class="bar" style="height: ${(panel.probs.overall / maxProb) * 250}px; background: ${panel.color};">
                        <div class="bar-value">${panel.probs.overall.toFixed(1)}%</div>
                    </div>
                    <div class="bar-label">${panel.party}</div>
                </div>
            `).join('');
        }

        function updateComparisonTable(panelResults) {
            const table = document.getElementById('comparisonTable');
            
            // Create header row
            let headerRow = '<tr><th>Metric</th>';
            panelResults.forEach(panel => {
                headerRow += `<th style="color: ${panel.color}">${panel.party}</th>`;
            });
            headerRow += '</tr>';
            
            // Create data rows
            const rows = [
                {
                    label: 'Overall Probability',
                    values: panelResults.map(p => `<strong>${p.probs.overall.toFixed(1)}%</strong>`)
                },
                {
                    label: 'VP Probability',
                    values: panelResults.map(p => `${p.probs.vp.toFixed(1)}%`)
                },
                {
                    label: 'GS Probability',
                    values: panelResults.map(p => `${p.probs.gs.toFixed(1)}%`)
                },
                {
                    label: 'AGS Probability',
                    values: panelResults.map(p => `${p.probs.ags.toFixed(1)}%`)
                },
                {
                    label: 'Organizational Strength',
                    values: panelResults.map(p => `${p.strengths.org}%`)
                },
                {
                    label: 'Media Visibility',
                    values: panelResults.map(p => `${p.strengths.media}%`)
                },
                {
                    label: 'Social Movement',
                    values: panelResults.map(p => `${p.strengths.social}%`)
                },
                {
                    label: 'Hall Influence',
                    values: panelResults.map(p => `${p.strengths.hall}%`)
                },
                {
                    label: 'Internal Cohesion',
                    values: panelResults.map(p => `${p.strengths.cohesion}%`)
                }
            ];
            
            let tableHTML = headerRow;
            rows.forEach(row => {
                tableHTML += '<tr>';
                tableHTML += `<td><strong>${row.label}</strong></td>`;
                row.values.forEach(value => {
                    tableHTML += `<td>${value}</td>`;
                });
                tableHTML += '</tr>';
            });
            
            table.innerHTML = tableHTML;
        }

        function updateInsights(panelResults) {
            const container = document.getElementById('insightsContainer');
            const sorted = [...panelResults];
            const leader = sorted[0];
            const runnerUp = sorted[1];
            
            const insights = [];
            
            // Add explanation of what the numbers mean
            insights.push(`📌 <strong>CRITICAL UNDERSTANDING:</strong> ${leader.probs.overall.toFixed(1)}% winning probability means ${leader.party} would win approximately ${Math.round(leader.probs.overall)} out of 100 elections if held today. This is NOT their expected vote share! With 5 competitive panels, even 38% probability makes them the frontrunner.`);
            
            // Scenario-specific insights
            if (currentScenario === 'base') {
                insights.push(`🎯 <strong>Base Case Analysis:</strong> ${leader.name} (${leader.party}) leads with ${leader.probs.overall.toFixed(1)}% probability. Their ${leader.strengths.cohesion}% internal cohesion (party unity) combined with ${leader.strengths.org}% organizational strength gives them an edge, but ${runnerUp.party}'s ${runnerUp.probs.overall.toFixed(1)}% chance keeps this race competitive.`);
            } else if (currentScenario === 'highTurnout') {
                insights.push(`📈 <strong>High Turnout Impact:</strong> With 60%+ turnout, social movement credibility becomes paramount. ${leader.name} shows ${leader.probs.overall.toFixed(1)}% probability in this scenario. The July 2024 uprising legacy heavily influences high-turnout elections.`);
            } else if (currentScenario === 'lowTurnout') {
                insights.push(`📉 <strong>Low Turnout Advantage:</strong> Below 30% turnout dramatically favors organizational machinery. ${leader.name}'s ${leader.strengths.org}% organizational strength translates to ${leader.probs.overall.toFixed(1)}% winning probability when only dedicated supporters vote.`);
            } else if (currentScenario === 'femaleVote') {
                insights.push(`👥 <strong>Female Vote Surge:</strong> If female students (18,902 registered) turn out strongly, social credibility and safety concerns dominate. ${leader.name} achieves ${leader.probs.overall.toFixed(1)}% probability by appealing to women's priorities.`);
            } else if (currentScenario === 'hallDominance') {
                insights.push(`🏢 <strong>Hall Politics Scenario:</strong> When residential hall networks dominate, ${leader.name} leverages ${leader.strengths.hall}% hall influence (through welfare activities, mentoring, meal programs) for ${leader.probs.overall.toFixed(1)}% winning probability.`);
            } else if (currentScenario === 'movementWave') {
                insights.push(`✊ <strong>Movement Wave Continues:</strong> If July 2024 uprising momentum persists, panels with movement credibility surge. ${leader.name} reaches ${leader.probs.overall.toFixed(1)}% probability in this anti-establishment environment.`);
            }
            
            // Explain why no one has very high probability
            insights.push(`❓ <strong>Why no panel exceeds 50% probability:</strong> With 5 competitive panels, 48.5% undecided voters (19,300 people), and the first election since 2019, even the strongest panel (${leader.party} at ${leader.probs.overall.toFixed(1)}%) would still lose ${(100 - leader.probs.overall).toFixed(0)} out of 100 times. This is a genuinely competitive race!`);
            
            // Gap analysis with context
            const gap = leader.probs.overall - runnerUp.probs.overall;
            if (gap < 5) {
                insights.push(`⚠️ <strong>Razor-thin margin:</strong> Only ${gap.toFixed(1)} percentage points separate ${leader.party} (${leader.probs.overall.toFixed(1)}%) from ${runnerUp.party} (${runnerUp.probs.overall.toFixed(1)}%). A single successful rally, endorsement, or controversy could flip these positions entirely.`);
            } else if (gap < 10) {
                insights.push(`📊 <strong>Competitive but clear leader:</strong> ${leader.party} maintains ${gap.toFixed(1)} point advantage over ${runnerUp.party}. Significant but surmountable - strong final week campaigning could close this gap.`);
            } else {
                insights.push(`📈 <strong>Commanding position:</strong> ${leader.party} holds ${gap.toFixed(1)} point lead over ${runnerUp.party}. While strong, remember this still means losing ${(100 - leader.probs.overall).toFixed(0)}% of simulated elections.`);
            }
            
            // VP specific analysis
            const vpLeader = [...panelResults].sort((a, b) => b.probs.vp - a.probs.vp)[0];
            insights.push(`🎖️ <strong>VP Race Breakdown:</strong> ${vpLeader.candidates.vp} (${vpLeader.party}) leads VP race at ${vpLeader.probs.vp.toFixed(1)}%. VP elections favor media visibility (${vpLeader.strengths.media}%) and social credibility (${vpLeader.strengths.social}%) over pure organizational strength, explaining why VP odds differ from overall panel probabilities.`);
            
            // Critical undecided factor
            insights.push(`🔄 <strong>THE GAME-CHANGER - Undecided Voters:</strong> 48.5% of registered voters (≈19,300 people) remain undecided. If they break just 60-40 toward ANY panel, that panel likely wins regardless of current projections. This massive uncertainty is why no panel exceeds 50% probability.`);
            
            // What internal strengths mean
            insights.push(`💪 <strong>Decoding Internal Strengths:</strong> ${leader.party}'s ${leader.strengths.cohesion}% cohesion means near-perfect internal unity (no infighting, coordinated campaign), NOT ${leader.strengths.cohesion}% chance to win! Similarly, ${leader.strengths.org}% organizational strength indicates superior ground game capability - ability to mobilize volunteers, not winning probability.`);
            
            // Election day dynamics
            insights.push(`⏰ <strong>Election Day Reality:</strong> With only 7 hours of voting (8 AM - 3 PM) on September 9, organizational efficiency becomes crucial. ${leader.party}'s ${leader.strengths.org}% organizational capacity could be decisive in getting supporters to polls within this narrow window.`);
            
            container.innerHTML = insights.map(insight => 
                `<div class="insight-item">${insight}</div>`
            ).join('');
        }

        // Initialize model on load
        document.addEventListener('DOMContentLoaded', function() {
            updateModel();
            
            // Update countdown timer
            const electionDate = new Date('2025-09-09T08:00:00');
            const updateCountdown = () => {
                const now = new Date();
                const diff = electionDate - now;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                
                if (diff > 0) {
                    document.getElementById('countdown').innerHTML = 
                        `⏳ Election in ${days} days, ${hours} hours | September 9, 2025 (8:00 AM - 3:00 PM)`;
                } else {
                    document.getElementById('countdown').innerHTML = 
                        `🗳️ ELECTION DAY - Polls Open 8:00 AM - 3:00 PM`;
                }
            };
            
            updateCountdown();
            setInterval(updateCountdown, 60000); // Update every minute
        });
    </script>
</body>
</html>